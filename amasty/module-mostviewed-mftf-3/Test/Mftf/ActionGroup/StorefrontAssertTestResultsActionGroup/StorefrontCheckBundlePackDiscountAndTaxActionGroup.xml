<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
* @author Amasty Team
* @copyright Copyright (c) 2022 Amasty (https://www.amasty.com)
* @package Automatic Related Products MFTF 3 for Magento 2 (System)
*/-->
<actionGroups xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/actionGroupSchema.xsd">
    <actionGroup name="StorefrontCheckBundlePackDiscountAndTaxActionGroup">
        <arguments>
            <argument name="mainProduct"/>
            <argument name="tax" defaultValue="amTestBundlePack.bundle_tax"/>
            <argument name="discount" defaultValue="amTestBundlePack.discount20"/>
            <argument name="shippingMethodsOnCheckout" defaultValue="FlatRateMethod"/>
            <argument name="qtyOfProducts" defaultValue="_enterQty2.qty"/>
        </arguments>
        <amOnPage url="{{StorefrontBundlePackPage.url}}" stepKey="amOnAllBundlePacksPage"/>
        <waitForElementVisible selector="{{StorefrontBundlePacksSection.addBundlePackToCart(mainProduct)}}"
                               stepKey="waitForRBundlePackAddToCartButtonVisible"/>
        <click selector="{{StorefrontBundlePacksSection.addBundlePackToCart(mainProduct)}}"
               stepKey="pressToAddBundlePackToCart"/>
        <waitForAjaxLoad stepKey="waitForAjaxLoadAfterAddBundlePackToCart"/>
        <click selector="{{StorefrontMinicartSection.showCart}}" stepKey="clickShowMinicart"/>
        <waitForElementVisible selector="{{StorefrontBundlePacksSection.productsInCart}}"
                               stepKey="waitForProductsInCartVisible"/>
        <seeNumberOfElements selector="{{StorefrontBundlePacksSection.productsInCart}}" userInput="{{qtyOfProducts}}"
                             stepKey="seeQtyProductsInCart"/>
        <click selector="{{StorefrontMinicartSection.goToCheckout}}" stepKey="goToCheckout"/>
        <waitForPageLoad stepKey="waitForCheckoutPageLoad"/>
        <conditionalClick selector="{{StorefrontCheckoutShippingAddressSection.ShipMethod(shippingMethodsOnCheckout.shippingMethodsNameOnCheckout)}}"
                          dependentSelector="{{StorefrontCheckoutShippingAddressSection.AmThemeShippingMethods}}"
                          visible="false" stepKey="selectShippingMethod"/>
        <click selector="{{StorefrontCheckoutShippingAddressSection.Next}}" stepKey="clickNext"/>
        <waitForPageLoad stepKey="waitForPageLoadAfterSubmitShipping"/>
        <seeElement selector="{{StorefrontBundlePacksSection.discountBlock(discount)}}"
                    stepKey="seeDiscountBlock"/>
        <click selector="{{StorefrontBundlePacksSection.expandTaxBlock}}" stepKey="pressToExpandTaxBlock"/>
        <seeElement selector="{{StorefrontBundlePacksSection.taxBlock(tax)}}" stepKey="seeTaxBlock"/>
        <click selector="{{StorefrontCheckoutPaymentAddressSection.PlaceOrder}}" stepKey="waitForPlaceOrderButton"/>
        <waitForPageLoad stepKey="waitForPageLoadAfterSubmitOrder"/>
        <click selector="{{StorefrontSuccessPageSection.OrderNumberCustomerAccount}}"
               stepKey="openOrderInCustomerAccount"/>
        <waitForPageLoad stepKey="waitForStoreFrontOrdersGridPageLoad"/>
        <seeElement selector="{{StorefrontBundlePacksSection.orderDiscountBlock(discount)}}"
                    stepKey="seeDiscountBlockOnStoreFrontOrderGrid"/>
        <seeElement selector="{{StorefrontBundlePacksSection.orderTaxBlock(tax)}}"
                    stepKey="seeTaxBlockOnStoreFrontOrderGrid"/>
    </actionGroup>
</actionGroups>
